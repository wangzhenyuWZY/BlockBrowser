name: Deploy
on: workflow_dispatch
jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      - name: init ssh, deploy
        run: |
          eval $(ssh-agent -s)
          echo "${{secrets.PRIVATE_KEY}}" > deploy.key
          mkdir -p ~/.ssh
          chmod 0600 deploy.key
          ssh-add deploy.key
          echo -e "Host *\n\tStrictHostKeyChecking no\n\n" > ~/.ssh/config
          pwd
          scp sh/restart.sh ${{secrets.SERVER_USERNAME}}@${{secrets.SERVER_HOST}}:~/sh/
          scp docker-compose.yml ${{secrets.SERVER_USERNAME}}@${{secrets.SERVER_HOST}}:~/sh/
          ssh ${{secrets.SERVER_USERNAME}}@${{secrets.SERVER_HOST}} "cd sh && sh restart.sh"
